import pickle
import time
import os
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager

def setup_session(platform_name, start_url):
    """
    Launches browser for user to login manually. 
    Saves cookies to file upon close.
    """
    print(f"--- SETUP SESSION FOR {platform_name} ---")
    print(f"1. Browser will open {start_url}")
    print("2. Please LOGIN manually using Mobile/OTP.")
    print("3. Once logged in, press ENTER in this terminal to save cookies.")
    
    driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()))
    driver.get(start_url)
    
    input(">>> PRESS ENTER HERE AFTER YOU HAVE LOGGED IN <<<")
    
    # Save Cookies
    cookies = driver.get_cookies()
    filename = f"{platform_name.lower().replace(' ', '')}_cookies.pkl"
    pickle.dump(cookies, open(filename, "wb"))
    
    print(f"SUCCESS: Cookies saved to {filename}")
    driver.quit()

if __name__ == "__main__":
    print("Which platform to setup?")
    print("1. BookMyShow")
    print("2. Paytm Insider")
    choice = input("Enter 1 or 2: ")
    
    if choice == "1":
        setup_session("BookMyShow", "https://in.bookmyshow.com")
    elif choice == "2":
        setup_session("Paytm Insider", "https://insider.in")
    else:
        print("Invalid choice")
